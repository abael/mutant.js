!function(t){function e(t,e,n){var i,a;return function(){var r=Date.now();i&&i+e>r?(clearTimeout(a),a=setTimeout(function(){i=r,t.apply(n)},e)):(i=r,t.apply(n))}}function n(t,e){return t.bind?t.bind(e):function(){var n=Array.prototype.slice.call(arguments);t.apply(e,n)}}function i(t,e){t||(t={});for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n]);return t}function a(t){this._callback=t,this._onModifications=e(function(){this._callback([])},5,this)}function r(t,e,n){this.element=t,this.callback=e,this.context=n,t.addEventListener("load",this,!1),t.addEventListener("error",this,!1)}function o(t){var e=!(1!==t.nodeType||"IMG"!==t.tagName||t.complete||t.getAttribute("width")&&t.getAttribute("height"));return e}function s(t,e){return t.dataset?t.dataset[e]:t.getAttribute("data-"+e)}function d(t,e,n){return t.dataset?void(t.dataset[e]=n):t.setAttribute("data-"+e,n)}function c(t,e){return t.dataset?void delete t.dataset[e]:void t.removeAttribute(attrName)}function l(){var t=u.createElement("fakeelement"),e={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var n in e)if(void 0!==t.style[n])return e[n]}function h(t,a,r){function o(){try{a.apply(d)}finally{l.takeRecords()}}r||(r={}),this._eventHandlers={};var s,d=r.scope||null,c=r.timeout||0,l=this;s=c?e(o,c):o,this._callback=s,this._findLoadingImages(t),this._mutationCallback=n(this._mutationCallback,this),this.observer=new f(this._mutationCallback);var h=i(r.observers,{attributes:!1,childList:!0,characterData:!1,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1});this.observer.observe(t,h),r.transitions&&(this._transitionEndHandler={target:t,handleEvent:function(){s()}},t.addEventListener(_,this._transitionEndHandler,!1))}a.prototype={observe:function(t){this._target=t,t.addEventListener("DOMSubtreeModified",this._onModifications,!1)},disconnect:function(){this._target&&(this._target.removeEventListener("DOMSubtreeModified",this._onModifications,!1),delete this._target)},takeRecords:function(){var t=this._target;this._target&&(t.removeEventListener("DOMSubtreeModified",this._onModifications,!1),t.addEventListener("DOMSubtreeModified",this._onModifications,!1))}},r.prototype={_detach:function(){this.element&&(this.element.removeEventListener("load",this,!1),this.element.removeEventListener("error",this,!1),this.element=null,this.callback=null,this.context=null)},handleEvent:function(t){this.callback.call(this.context,t,this)}};var u=t.document,f=t.MutationObserver||t.MozMutationObserver||t.WebKitMutationObserver||a,v=0,_=l();return h.prototype={_addListener:function(t){if(!s(t,"gLoadListenerId")){var e=++v;d(t,"gLoadListenerId",e),this._eventHandlers[e]=new r(t,function(t,e){e._detach(),this._callback()},this)}},_removeListener:function(t){var e=s(t,"gLoadListenerId");if(e){c(t,"gLoadListenerId");var n=this._eventHandlers[e];n&&(delete this._eventHandlers[e],n._detach())}},_mutationCallback:function(t){var e=this;t.forEach(function(t){var n;if("childList"===t.type){if(t.addedNodes)for(var i=0;i<t.addedNodes.length;i++)n=t.addedNodes[i],1===n.nodeType&&(n.children.length?e._findLoadingImages(n):o(n)&&e._addListener(n));if(t.removedNodes)for(var a=0;a<t.removedNodes.length;a++)n=t.removedNodes[a],1===n.nodeType&&(n.children.length||"IMG"===n.tagName&&e._removeListener(n))}}),this._callback()},_findLoadingImages:function(t){for(var e=t.querySelectorAll("img"),n=0;n<e.length;n++){var i=e[n];o(i)&&this._addListener(i)}},takeRecords:function(){return this.observer.takeRecords()},disconnect:function(){if(this.observer.disconnect(),this._transitionEndHandler){var t=this._transitionEndHandler.target;t.removeEventListener(_,this._transitionEndHandler,!1)}var e=this._eventHandlers;Object.keys(e).forEach(function(t){var n=e[t];n&&(delete e[t],n._detach())})}},t.Mutant=h,"function"==typeof define&&define.amd&&define([],function(){return h}),h}(window);
//@ sourceMappingURL=mutant-min.js.map