!function(e){function t(e,t,i){var r,a;return function(){var n=Date.now();r&&r+t>n?(clearTimeout(a),a=setTimeout(function(){r=n,e.apply(i)},t)):(r=n,e.apply(i))}}function i(e,t){return e.bind?e.bind(t):function(){var i=Array.prototype.slice.call(arguments);e.apply(t,i)}}function r(e){this._callback=e,this._onModifications=t(function(){this._callback([])},5,this)}function a(e,t,i){this.element=e,this.callback=t,this.context=i,e.addEventListener("load",this,!1),e.addEventListener("error",this,!1)}function n(e){var t=!(1!==e.nodeType||"IMG"!==e.tagName||e.complete||e.getAttribute("width")&&e.getAttribute("height"));return t}function s(e,t){return e.dataset?e.dataset[t]:e.getAttribute("data-"+t)}function o(e,t,i){return e.dataset?void(e.dataset[t]=i):e.setAttribute("data-"+t,i)}function d(e,t){return e.dataset?void delete e.dataset[t]:void e.removeAttribute(attrName)}function c(e,r,a){this._eventHandlers={};var n=a&&a.scope?a.scope:null,s=a&&a.timeout?a.timeout:0,o=this;this._callback=s?t(function(){try{r.apply(n)}finally{o.takeRecords()}},s):function(){try{r.apply(n)}finally{o.takeRecords()}},this._findLoadingImages(e),this._mutationCallback=i(this._mutationCallback,this),this.observer=new l(this._mutationCallback);var d={attributes:a&&a.observers&&a.observers.attributes||!1,childList:a&&a.observers&&a.observers.childList?a.types.childList:!0,characterData:a&&a.observers&&a.observers.characterData||!1,subtree:a&&a.observers&&a.observers.subtree?a.types.subtree:!0,attributeFilter:a&&a.observers&&a.observers.attributeFilter||[]};d.attributes&&a.observers.attributeOldValue&&(d.attributeOldValue=a.observers.attributeOldValue),d.characterData&&a.observers.characterDataOldValue&&(d.characterDataOldValue=a.observers.characterDataOldValue),this.observer.observe(e,d)}r.prototype={observe:function(e){this._target=e,e.addEventListener("DOMSubtreeModified",this._onModifications,!1)},disconnect:function(){this._target&&(this._target.removeEventListener("DOMSubtreeModified",this._onModifications,!1),delete this._target)},takeRecords:function(){var e=this._target;this._target&&(e.removeEventListener("DOMSubtreeModified",this._onModifications,!1),e.addEventListener("DOMSubtreeModified",this._onModifications,!1))}},a.prototype={_detach:function(){this.element&&(this.element.removeEventListener("load",this,!1),this.element.removeEventListener("error",this,!1),this.element=null,this.callback=null,this.context=null)},handleEvent:function(e){this.callback.call(this.context,e,this)}};var l=(e.document,e.MutationObserver||e.MozMutationObserver||e.WebKitMutationObserver||r),u=0;return c.prototype={_addListener:function(e){if(!s(e,"gLoadListenerId")){var t=++u;o(e,"gLoadListenerId",t),this._eventHandlers[t]=new a(e,function(e,t){t._detach(),this._callback()},this)}},_removeListener:function(e){var t=s(e,"gLoadListenerId");if(t){d(e,"gLoadListenerId");var i=this._eventHandlers[t];i&&(delete this._eventHandlers[t],i._detach())}},_mutationCallback:function(e){var t=this;e.forEach(function(e){var i;if("childList"===e.type){if(e.addedNodes)for(var r=0;r<e.addedNodes.length;r++)i=e.addedNodes[r],1===i.nodeType&&(i.children.length?t._findLoadingImages(i):n(i)&&t._addListener(i));if(e.removedNodes)for(var a=0;a<e.removedNodes.length;a++)i=e.removedNodes[a],1===i.nodeType&&(i.children.length||"IMG"===i.tagName&&t._removeListener(i))}}),this._callback()},_findLoadingImages:function(e){for(var t=e.querySelectorAll("img"),i=0;i<t.length;i++){var r=t[i];n(r)&&this._addListener(r)}},takeRecords:function(){return this.observer.takeRecords()},disconnect:function(){this.observer.disconnect();var e=this._eventHandlers;Object.keys(e).forEach(function(t){var i=e[t];i&&(delete e[t],i._detach())})}},e.Mutant=c,"function"==typeof define&&define.amd&&define([],function(){return c}),c}(window);
//@ sourceMappingURL=mutant-min.js.map